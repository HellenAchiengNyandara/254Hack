{% extends 'userauth/base.html' %}
{% load static %}

{% block title %}Contact Us - Food Price Predictor{% endblock %}

{% block content %}
<style>
    .contact-info-card {
        background-color: #f8f9fa;
        border-left: 4px solid #0d6efd;
    }
    
    .footer {
        background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
        color: white;
    }
    
    .footer a {
        color: #e3f2fd !important;
        transition: color 0.3s ease;
    }
    
    .footer a:hover {
        color: #ffffff !important;
    }
    
    .social-links a {
        transition: transform 0.3s ease;
    }
    
    .social-links a:hover {
        transform: translateY(-3px);
    }
    
    .navbar {
        background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%) !important;
    }
    
    .navbar-brand, .nav-link {
        color: white !important;
    }
    
    .nav-link:hover {
        color: #e3f2fd !important;
    }
</style>

<div class="container py-5">
    <!-- Introduction Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h2 class="text-center mb-4">Get in Touch</h2>
                    <p class="lead text-center">
                        We're here to help! Whether you have questions about our food price predictions, 
                        need assistance with the platform, or want to provide feedback, we'd love to hear from you.
                    </p>
                    <p class="text-center">
                        Fill out the form on the right, and we'll get back to you as soon as possible.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Contact Information Column -->
        <div class="col-md-4">
            <div class="card shadow-sm h-100 contact-info-card">
                <div class="card-body">
                    <h3 class="card-title mb-4">Contact Information</h3>
                    
                    <div class="d-flex align-items-center mb-4">
                        <i class="fas fa-user-circle fa-2x me-3 text-primary"></i>
                        <div>
                            <h5 class="mb-1">Ogol Benard Omondi</h5>
                            <p class="text-muted mb-0">Project Manager</p>
                        </div>
                    </div>

                    <div class="d-flex align-items-center mb-4">
                        <i class="fas fa-envelope fa-2x me-3 text-primary"></i>
                        <div>
                            <h5 class="mb-1">Email</h5>
                            <p class="text-muted mb-0">obernard377@gmail.com</p>
                        </div>
                    </div>

                    <div class="d-flex align-items-center mb-4">
                        <i class="fas fa-phone fa-2x me-3 text-primary"></i>
                        <div>
                            <h5 class="mb-1">Phone</h5>
                            <p class="text-muted mb-0">+254 742 423 200</p>
                        </div>
                    </div>

                    <div class="d-flex align-items-center mb-4">
                        <i class="fas fa-map-marker-alt fa-2x me-3 text-primary"></i>
                        <div>
                            <h5 class="mb-1">Location</h5>
                            <p class="text-muted mb-0">Nairobi, Kenya</p>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5 class="mb-3">Follow Us</h5>
                        <div class="d-flex gap-3 social-links">
                            <a href="https://facebook.com/your-profile" target="_blank" class="text-primary" title="Facebook">
                                <i class="fab fa-facebook fa-2x"></i>
                            </a>
                            <a href="https://twitter.com/your-profile" target="_blank" class="text-primary" title="Twitter">
                                <i class="fab fa-twitter fa-2x"></i>
                            </a>
                            <a href="https://linkedin.com/in/your-profile" target="_blank" class="text-primary" title="LinkedIn">
                                <i class="fab fa-linkedin fa-2x"></i>
                            </a>
                            <a href="https://instagram.com/your-profile" target="_blank" class="text-primary" title="Instagram">
                                <i class="fab fa-instagram fa-2x"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Form Column -->
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <h3 class="card-title mb-4">Send us a Message</h3>
                    <div id="alert-message"></div>
                    <form id="contact-form" method="POST">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="phone_number" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="phone_number" name="phone_number" 
                                       pattern="^(?:\+254|0|254)[17]\d{8}$" 
                                       placeholder="+254XXXXXXXXX or 0XXXXXXXXX" 
                                       title="Please enter a valid Kenyan phone number starting with +254, 254, or 0"
                                       required>
                                <div class="form-text">Enter a valid Kenyan phone number (e.g., +254XXXXXXXXX, 254XXXXXXXXX, or 0XXXXXXXXX)</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="subject" class="form-label">Subject</label>
                                <input type="text" class="form-control" id="subject" name="subject" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="message" class="form-label">Message</label>
                            <textarea class="form-control" id="message" name="message" rows="5" required></textarea>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary" id="submit-btn">
                                <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                                Send Message
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer py-4 mt-5">
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <h5>Food Price Predictor</h5>
                <p>Helping you make informed decisions about food prices in Kenya.</p>
            </div>
            <div class="col-md-4">
                <h5>Quick Links</h5>
                <ul class="list-unstyled">
                    <li><a href="{% url 'home' %}" class="text-decoration-none">Home</a></li>
                    <li><a href="{% url 'market_trends' %}" class="text-decoration-none">Market Trends</a></li>
                    <li><a href="{% url 'make_prediction' %}" class="text-decoration-none">Make Prediction</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <h5>Contact Info</h5>
                <ul class="list-unstyled">
                    <li><i class="fas fa-envelope me-2"></i> obernard377@gmail.com</li>
                    <li><i class="fas fa-phone me-2"></i> +254 742 423 200</li>
                    <li><i class="fas fa-map-marker-alt me-2"></i> Nairobi, Kenya</li>
                </ul>
            </div>
        </div>
        <hr class="bg-light">
        <div class="text-center">
            <small>&copy; {% now "Y" %} Food Price Predictor. All rights reserved.</small>
        </div>
    </div>
</footer>

<!-- Add Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<script>
// Add phone number validation
document.getElementById('phone_number').addEventListener('input', function(e) {
    let value = e.target.value;
    // Remove any non-digit characters except +
    value = value.replace(/[^\d+]/g, '');
    
    // Handle different formats
    if (value.startsWith('+254')) {
        // Already in correct format
        e.target.value = value;
    } else if (value.startsWith('254')) {
        // Add + prefix
        e.target.value = '+' + value;
    } else if (value.startsWith('0')) {
        // Replace leading 0 with +254
        e.target.value = '+254' + value.substring(1);
    } else if (value.length > 0) {
        // Assume it's a local number, add +254
        e.target.value = '+254' + value;
    }
});

document.getElementById('contact-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = this;
    const submitBtn = document.getElementById('submit-btn');
    const spinner = submitBtn.querySelector('.spinner-border');
    const alertDiv = document.getElementById('alert-message');
    
    // Validate phone number format
    const phoneInput = document.getElementById('phone_number');
    const phoneValue = phoneInput.value;
    const phonePattern = /^(?:\+254|0|254)[17]\d{8}$/;
    
    if (!phonePattern.test(phoneValue)) {
        alertDiv.innerHTML = `
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                Please enter a valid Kenyan phone number (e.g., +254XXXXXXXXX, 254XXXXXXXXX, or 0XXXXXXXXX)
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
        return;
    }
    
    // Show loading state
    submitBtn.disabled = true;
    spinner.classList.remove('d-none');
    
    // Get form data
    const formData = new FormData(form);
    
    // Send request
    fetch('{% url "contact" %}', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        // Show success/error message
        alertDiv.innerHTML = `
            <div class="alert alert-${data.status === 'success' ? 'success' : 'danger'} alert-dismissible fade show" role="alert">
                ${data.message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
        
        if (data.status === 'success') {
            form.reset();
        }
    })
    .catch(error => {
        // Show error message
        alertDiv.innerHTML = `
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                ${error.message || 'An error occurred. Please try again later.'}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
        console.error('Error:', error);
    })
    .finally(() => {
        // Reset button state
        submitBtn.disabled = false;
        spinner.classList.add('d-none');
    });
});
</script>
{% endblock %} 